# ExpressJS + React
* Step by step guide in migrating https://github.com/brayramirez/phonebook from Rails to ExpressJS

## Prerequisites
* Express
* Express Generator

## Guide
1. Generate express app
  * `express [my_app]
  
1. Copy the following files/directories from Rails App to our new Express App
  * Client directory (https://github.com/brayramirez/phonebook/tree/master/client)
  * Webpack config (https://github.com/brayramirez/phonebook/blob/master/webpack.config.js)
  * Other necessary files (favicon, stylesheets, external javascript files)

1. Copy scripts and dependencies from `package.json` (https://github.com/brayramirez/phonebook/blob/master/package.json)

1. Remove unnecessary files generated by express generator (e.g. routes)

1. Update `layout.jade`
  ```jade
  doctype html
  html
    head
      title App
      link(rel='stylesheet', href='/stylesheets/style.css')
    body
      #react-container!= reactComponent
      script(type='text/javascript', src='http://localhost:8080/bundle.js')
  ```
  
1. Create custom routes containing React routes inside `routes` directory
  ```js
  var express = require('express');
  var router = express.Router();

  var React = require('react');
  var ReactDOMServer = require('react-dom/server');

  var match = require('react-router').match;
  var RoutingContext = require('react-router').RoutingContext;
  var routes = require('client/routes.jsx'); // This contains React routes

  router.get('*', function(req, res) {
    match({ routes: routes, location: req.url}, function(error, redirectLocation, renderProps) {
      var reactComponent = ReactDOMServer.renderToString(React.createElement(RoutingContext, renderProps));
      var component = '<div>' + reactComponent + '</div>';

      res.render('layout', { reactComponent: component });
    });
  });

  module.exports = router;
  ```

1. Update `app.js` (server) to include our routes and use `babel-core` to interpret jsx files
  ```js
  require('babel-core/register');
  ...
  var clientRoutes = require('./routes/client.js');

  app.use('/', clientRoutes);
  ...
  ```

1. Create `.babelrc`
  ```js
  {
    "presets": [
      "react"
    ]
  }
  ```

1. Update Rails controller to allow port being used by express (3000)
  `headers['Access-Control-Allow-Origin'] = 'http://localhost:3000'`
  
1. Adjust API calls to point to the correct API port number

1. Running the application
  1. Rails API
    * run in any port except `3000` or `8080`
  1. Webpack-dev-server
    * npm run devserve
    * this will be running in port `8080`
  1. ExpressJS
    * DEBUG=:* npm start
    * this will be running in port `3000`
